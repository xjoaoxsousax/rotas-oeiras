<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rota de Transporte</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
  <h1>Buscar Rota</h1>
  <input type="text" id="routeNumber" placeholder="Digite o número da rota">
  <button onclick="loadRoute()">Buscar</button>
  <div id="map" style="width: 100%; height: 400px;"></div>
  <div id="downloadButtons"></div>

  <script>
    const map = L.map('map').setView([38.7169, -9.2099], 12); // Posição inicial do mapa
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    function loadRoute() {
      const routeNumber = document.getElementById('routeNumber').value;
      const routePath = `/rotas/${routeNumber}/route.json`; // Caminho ajustado

      // Busca o arquivo JSON que descreve o percurso da rota
      fetch(routePath)
        .then(response => response.json())
        .then(data => {
          const routeCoords = data.route.map(point => [point.lat, point.lng]); // Estrutura de coordenadas

          // Desenha a linha da rota no mapa
          L.polyline(routeCoords, { color: 'blue' }).addTo(map);

          // Exibe os botões de download para as variações
          const downloadButtons = document.getElementById('downloadButtons');
          downloadButtons.innerHTML = ''; // Limpa os botões anteriores
          
          data.variations.forEach(variation => {
            const button = document.createElement('button');
            button.textContent = `Baixar ${variation.name}`;
            button.onclick = () => downloadGPX(variation.gpxFile);
            downloadButtons.appendChild(button);
          });
        })
        .catch(error => {
          console.error('Erro ao carregar a rota:', error);
        });
    }

    function downloadGPX(gpxFile) {
      const link = document.createElement('a');
      link.href = `/rotas/gpx/${gpxFile}`; // Caminho do arquivo GPX no repositório
      link.download = gpxFile;
      link.click();
    }
  </script>
</body>
</html>
